<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Platform and compiler &mdash; LIVVKit 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="LIVVKit 2.0.0 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>The build and test structure (BATS) is controlled through command line
options to the <code class="docutils literal"><span class="pre">build_and_test.py</span></code> script. All of
<code class="docutils literal"><span class="pre">./build_and_test.py</span></code>&#8216;s options are <em>optional</em> and have default
values. The full set of options that may be passed, and their defaults,
are:</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">the</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>

<span class="o">-</span><span class="n">p</span> <span class="n">PLATFORM</span><span class="p">,</span> <span class="o">--</span><span class="n">platform</span> <span class="n">PLATFORM</span>
                      <span class="n">Your</span> <span class="n">computer</span> <span class="n">platform</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">linux</span><span class="p">)</span>

<span class="o">-</span><span class="n">c</span> <span class="n">COMPILER</span><span class="p">,</span> <span class="o">--</span><span class="n">compiler</span> <span class="n">COMPILER</span>
                      <span class="n">The</span> <span class="n">compiler</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">gnu</span><span class="p">)</span>

<span class="o">-</span><span class="n">i</span> <span class="n">CISM_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">cism</span><span class="o">-</span><span class="nb">dir</span> <span class="n">CISM_DIR</span>
                      <span class="n">Location</span> <span class="n">of</span> <span class="n">the</span> <span class="n">CISM</span> <span class="n">source</span> <span class="n">code</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="o">../..</span><span class="p">)</span>

<span class="o">-</span><span class="n">b</span> <span class="n">BUILD_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="nb">dir</span> <span class="n">BUILD_DIR</span>
                      <span class="n">Location</span> <span class="n">to</span> <span class="n">build</span> <span class="n">CISM</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="o">./</span><span class="n">build</span><span class="p">)</span>

<span class="o">-</span><span class="n">j</span> <span class="n">J</span>                  <span class="n">Number</span> <span class="n">of</span> <span class="n">processors</span> <span class="n">to</span> <span class="n">use</span> <span class="n">when</span> <span class="n">making</span> <span class="n">CISM</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">8</span><span class="p">)</span>

<span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">build</span>      <span class="n">Skip</span> <span class="n">build</span><span class="p">,</span> <span class="ow">and</span> <span class="n">look</span> <span class="k">for</span> <span class="n">the</span> <span class="n">CISM</span> <span class="n">driver</span> <span class="ow">in</span><span class="p">:</span>
                          <span class="n">BUILD_DIR</span><span class="o">/</span><span class="n">cism_driver</span><span class="o">/</span><span class="n">cism_driver</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>

<span class="o">-</span><span class="n">o</span> <span class="n">OUT_DIR</span><span class="p">,</span> <span class="o">--</span><span class="n">out</span><span class="o">-</span><span class="nb">dir</span> <span class="n">OUT_DIR</span>
                      <span class="n">Location</span> <span class="n">of</span> <span class="n">the</span> <span class="n">directoy</span> <span class="n">to</span> <span class="n">output</span> <span class="n">the</span> <span class="n">test</span> <span class="n">data</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">reg_test</span><span class="p">)</span>

<span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">force</span>           <span class="n">Suppress</span> <span class="nb">any</span> <span class="n">warning</span> <span class="n">about</span> <span class="n">possibly</span> <span class="n">overwriting</span> <span class="n">test</span> <span class="n">data</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>

<span class="o">--</span><span class="n">timing</span>              <span class="n">Run</span> <span class="n">the</span> <span class="n">timing</span> <span class="n">test</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">new</span>
                      <span class="n">benchmark</span> <span class="n">dataset</span><span class="o">.</span> <span class="n">Selecting</span> <span class="n">this</span> <span class="n">option</span> <span class="n">will</span> <span class="n">force</span> <span class="n">the</span>
                      <span class="o">--</span><span class="n">performance</span> <span class="n">option</span> <span class="n">to</span> <span class="n">true</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>

<span class="o">--</span><span class="n">performance</span>         <span class="n">Run</span> <span class="n">the</span> <span class="n">performance</span> <span class="n">tests</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span> <span class="o">--</span> <span class="n">unless</span> <span class="n">timing</span> <span class="n">option</span> <span class="ow">is</span> <span class="n">specified</span> <span class="ow">or</span>
                                         <span class="n">HPC</span> <span class="n">system</span> <span class="ow">is</span> <span class="n">detected</span><span class="p">,</span> <span class="n">then</span> <span class="n">will</span> <span class="n">be</span>
                                         <span class="n">forced</span> <span class="n">to</span> <span class="n">true</span> <span class="n">always</span><span class="p">)</span>

<span class="o">--</span><span class="n">sleep</span> <span class="n">SLEEP</span>         <span class="n">Number</span> <span class="n">of</span> <span class="n">seconds</span> <span class="n">to</span> <span class="n">sleep</span> <span class="n">between</span> <span class="n">checks</span> <span class="n">on</span> <span class="n">running</span>
                      <span class="n">tests</span><span class="o">.</span> <span class="n">Only</span> <span class="n">used</span> <span class="n">on</span> <span class="n">personal</span> <span class="n">machines</span><span class="p">,</span> <span class="n">when</span> <span class="n">HPC</span> <span class="n">systems</span>
                      <span class="n">are</span> <span class="n">detected</span><span class="p">,</span> <span class="n">BATS</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">run</span> <span class="n">the</span> <span class="n">tests</span> <span class="ow">and</span> <span class="n">just</span> <span class="n">creates</span>
                      <span class="n">the</span> <span class="n">batch</span> <span class="n">jobs</span><span class="o">.</span>
                      <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="platform-and-compiler">
<h1>Platform and compiler<a class="headerlink" href="#platform-and-compiler" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">-p</span></code>/<code class="docutils literal"><span class="pre">--platform</span></code> option and the <code class="docutils literal"><span class="pre">-c</span></code>/<code class="docutils literal"><span class="pre">--compiler</span></code> option
are used extensively throughout BATS and <em>should always be set
appropriately.</em></p>
<p>The platform option will determine if you are running on an high
performance computer (HPC) or a personal computer (PC). On HPCs, bats
sets up the tests and creates job scripts, while on PCs, BATS will
directly run the tests. Additionally, if an HPC platform is selected,
BATS will automatically turn on the <code class="docutils literal"><span class="pre">--performance</span></code> option (discussed
below).</p>
<p>Additionally, the values passed to the platform and compiler options are
used in combination to locate the appropriate build script and determine
the name of the output sub-directory. Within the CISM source code
(specified by <code class="docutils literal"><span class="pre">-i</span></code>/<code class="docutils literal"><span class="pre">--cism-dir</span></code>), the scripts to set the CMake build
variables is located at
<code class="docutils literal"><span class="pre">builds/PLATFORM-COMPILER/PLATFORM-COMPILER-cmake.bash</span></code> (note: BATS
uses the bash scripts to perform an <a class="reference external" href="CISM-out-of-source-builds">out-of-source
build</a>). If either the platform or
compiler option is set incorrectly, BATS may try to build CISM
incorrectly, or be unable to locate the build script (if BATS is
building CISM &#8211; more build info below).</p>
<p>Within the specified output directory (<code class="docutils literal"><span class="pre">-o/--out-dir</span></code>) BATS creates a
subdirectory called <code class="docutils literal"><span class="pre">PLATFORM-COMPILER/</span></code> which contains all the
regression testing data for LIVVkit. The creation of this subdirectory,
and the use of out of source builds, allows many different compilers to
be tested and all the data from these different sets of regression tests
to live within the same output directory (default: <code class="docutils literal"><span class="pre">reg_test/</span></code>).</p>
</div>
<div class="section" id="locating-the-cism-source">
<h1>Locating the CISM source<a class="headerlink" href="#locating-the-cism-source" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">-i</span></code>/<code class="docutils literal"><span class="pre">--cism-dir</span></code> option allows you to point to a different CISM
location than the one <code class="docutils literal"><span class="pre">build_and_test.py</span></code> is located in (defaults to
parent source code). BATS will look for the build scripts, and
individual run files within this location.</p>
<p><em>Note: This option is only needed if you&#8217;ve moved the entirety of BATS
out of the CISM source and are trying to run it externally.</em></p>
</div>
<div class="section" id="controlling-the-cism-build">
<h1>Controlling the CISM build<a class="headerlink" href="#controlling-the-cism-build" title="Permalink to this headline">¶</a></h1>
<p>BATS will build CISM into any directory specified by the
<code class="docutils literal"><span class="pre">-b</span></code>/<code class="docutils literal"><span class="pre">--build-dir</span></code> option using the build script
<code class="docutils literal"><span class="pre">builds/PLATFORM-COMPILER/PLATFORM-COMPILER-cmake.bash</span></code> (note: BATS
uses this script to perform an <a class="reference external" href="CISM-out-of-source-builds">out-of-source
build</a>). BATS will use the number of jobs
specified by the <code class="docutils literal"><span class="pre">-j</span></code> option when building CISM (equivalent to
<code class="docutils literal"><span class="pre">make</span></code>&#8216;s <code class="docutils literal"><span class="pre">-j</span></code> option).</p>
<p>In some use cases, you may build CISM manually or you may already have a
version of CISM built which you would like to use when running the
tests. By specifying the <code class="docutils literal"><span class="pre">s</span></code>/<code class="docutils literal"><span class="pre">--skip-build</span></code> option, BATS will not
build CISM, but instead look for a CISM driver in the
<code class="docutils literal"><span class="pre">BUILD_DIR/cism_driver/</span></code> directory (e.g., the <a class="reference external" href="Workflow-developer">developer&#8217;s
workflow</a>).</p>
</div>
<div class="section" id="bats-output-data">
<h1>BATS output data<a class="headerlink" href="#bats-output-data" title="Permalink to this headline">¶</a></h1>
<p>BATS will output all the regression tests data to a
<code class="docutils literal"><span class="pre">PLATFORM-COMPILER</span></code> subdirectory within the directory specified by
<code class="docutils literal"><span class="pre">-o</span></code>/<code class="docutils literal"><span class="pre">--out-dir</span></code>. BATS will make sure no data currently exists
within that <em>subdirectory</em> and will throw an error if data does exist
within it. However, you can force BATS to ignore, and overwrite,
pre-existing data with the <code class="docutils literal"><span class="pre">-f</span></code>/<code class="docutils literal"><span class="pre">--force</span></code> option.</p>
<p>See the <a class="reference external" href="BATS-reg-test">regression tests data</a> page for a description
of the output data.</p>
</div>
<div class="section" id="running-the-tests">
<h1>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this headline">¶</a></h1>
<p>BATS will always run a default set of regression tests. The
<code class="docutils literal"><span class="pre">--performance</span></code> and <code class="docutils literal"><span class="pre">--timing</span></code> options both specify more tests to
run.</p>
<p><code class="docutils literal"><span class="pre">--performance</span></code> will run all the performance tests specified in the
BATS module located at <code class="docutils literal"><span class="pre">util/dicts.py</span></code> (from the location of
<code class="docutils literal"><span class="pre">build_and_test.py</span></code>). On HPCs, BATS will run the additional
performance tests contained within the <code class="docutils literal"><span class="pre">*_perf_small</span></code> dictionaries
(<code class="docutils literal"><span class="pre">*</span></code> is the regular expression&#8217;s expansion) and the <code class="docutils literal"><span class="pre">perf_dict</span></code>
dictionary (contains the large performance tests, where large means
tests that use more than 16 processing cores). On PCs, BATS will only
run the small performance tests. (Note, this option is forced on for
HPCs.)</p>
<p>The <code class="docutils literal"><span class="pre">--timing</span></code> option will run each of the above mentioned performance
tests an additional 10 times in order to get the variance in the
performance metrics (primarily run time). To create a new benchmark,
this option should be used. (This option will also ensure the
<code class="docutils literal"><span class="pre">--performance</span></code> option is on.)</p>
<p>Additionally, on PCs, BATS will automatically start running all the
specified tests as subprocesses. BATS will then sleep for a number of
sections specified by the <code class="docutils literal"><span class="pre">--sleep</span></code> option while the subprocesses are
running. After the sleep time has elapsed, BATS will check on the
subprocesses and if any are still running, sleep again. For the default
test cases, the default sleep value should be adequate. If the
<code class="docutils literal"><span class="pre">--performance</span></code> or <code class="docutils literal"><span class="pre">--timing</span></code> option has been specified, you may
want to increase the sleep time to prevent an excessive amount of print
statements being generated from the large number of subprocess checks.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Platform and compiler</a></li>
<li><a class="reference internal" href="#locating-the-cism-source">Locating the CISM source</a></li>
<li><a class="reference internal" href="#controlling-the-cism-build">Controlling the CISM build</a></li>
<li><a class="reference internal" href="#bats-output-data">BATS output data</a></li>
<li><a class="reference internal" href="#running-the-tests">Running the tests</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/BATS-options.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Katherine Evans, Joseph Kennedy, Andrew Bennett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/BATS-options.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>