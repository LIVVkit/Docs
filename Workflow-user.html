<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Users workflow &mdash; LIVVKit 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="LIVVKit 2.0.0 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="users-workflow">
<h1>Users workflow<a class="headerlink" href="#users-workflow" title="Permalink to this headline">¶</a></h1>
<p>Using this workflow will allow you to perform a software <a class="reference external" href="VV-code-verification">code
verification</a> of a model installation.
Typically, this workflow will be used to build the latest model release,
and then evaluate that build against a developer-provided set of
benchmark data.</p>
<p>There are 3 steps to the development workflow:</p>
<ol class="arabic simple">
<li>Get the needed benchmark dataset</li>
<li>Build the latest versions of the model and generate the test dataset</li>
<li>Use LIVVkit to analyze the datasets</li>
</ol>
<p>Note, LIVVkit is currently being developed and used in conjunction with
the Community Ice Sheet Model
(<a class="reference external" href="http://oceans11.lanl.gov/cism/documentation.html">CISM</a>), and these
instruction are described for use with CISM. CISM includes a <a class="reference external" href="Build-and-test">build and
test structure (BATS)</a> which is capable of building
CISM and then using that build to generate a dataset for use with
LIVVkit. LIVVkit can be easily extended to other ice sheet models by
creating a BATS for it &#8211; LIVVkit itself is model agnostic and only
analyzes the output data. Follow the link above for a detailed
description of BATS.</p>
<div class="section" id="getting-the-needed-benchmark-dataset">
<h2>1. Getting the needed benchmark dataset<a class="headerlink" href="#getting-the-needed-benchmark-dataset" title="Permalink to this headline">¶</a></h2>
<p>First, starting in a directory called <code class="docutils literal"><span class="pre">$BASE</span></code>, clone CISM and LIVVkit.</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>cd $BASE
git clone https://github.com/ACME-Climate/cism-piscees.git
git clone https://github.com/ACME-Climate/LIVV.git
</pre></div>
</div>
<p>Benchmark datasets can be found at <a class="reference external" href="http://oceans11.lanl.gov/cism/livv/">http://oceans11.lanl.gov/cism/livv/</a>.
Here, you will find files named
<code class="docutils literal"><span class="pre">reg_bench.PLATFORM.CISM-VERSION.tar.gz</span></code> that contain benchmark
datasets. You can use any of these benchmark datasets, but you should
use the one that <em>best matches your version of CISM and the platform you
are working on.</em></p>
<p>Download the benchmark dataset and extract it in <code class="docutils literal"><span class="pre">$BASE</span></code>. You will
then have a new directory called
<code class="docutils literal"><span class="pre">$BASE/reg_bench.PLATFORM.CISM-VERSION/</span></code>.</p>
<p>On some high performance computers (HPCs), such as titan at ORNL and
hopper at NERSC, the benchmark data will already be located there. You
can see if a dataset exists on your platform by looking in LIVVkit&#8217;s
configurations directory:</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>ls $BASE/LIVV/configurations/
</pre></div>
</div>
<p>Which will display a list of <code class="docutils literal"><span class="pre">PLATFORM-COMPILER</span></code> configuration files.
If a configuration file exists for your platform-compiler, the benchmark
dataset exists and that file will contain its location. This file will
be directly loaded into LIVVkit, and you need not open it to find the
location.</p>
<p>If a configuration is missing for your compiler, you can use one of the
alternate compiler files. If a configuration file is missing for your
platform, you will have to download the dataset that best matches your
platform from the location mentioned above. In both of these cases, you
should not expect bit-for-bit results, but you can still use the cross
platform/compiler comparison to get an idea of the relative level of
errors.</p>
<p>Now, you can start building CISM and generating your test dataset.</p>
<div class="section" id="build-the-latest-version-of-cism-and-generate-the-test-dataset">
<h3>2. Build the latest version of CISM and generate the test dataset<a class="headerlink" href="#build-the-latest-version-of-cism-and-generate-the-test-dataset" title="Permalink to this headline">¶</a></h3>
<p>Go to BATS in your clone of CISM, and use BATS to build and generate
test dataset for your platform (<code class="docutils literal"><span class="pre">PLATFORM</span></code>) and compiler of choice
(<code class="docutils literal"><span class="pre">COMPILER</span></code>). We will use <code class="docutils literal"><span class="pre">PLATFORM=titan</span></code> and <code class="docutils literal"><span class="pre">COMPILER=gnu</span></code> for
this example. See the <a class="reference external" href="build-and-test">BATS</a> documentation for
supported platform and compiler combinations.</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>cd $BASE/cism-piscees/tests/regression/
source setup_titan.bash
./build_and_test.py -p titan -c gnu -o $BASE/reg_test
</pre></div>
</div>
<p>If you get the error message:</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span><span class="n">ERROR</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">find</span> <span class="n">your</span> <span class="n">cmake</span> <span class="n">file</span><span class="p">:</span><span class="o">...</span>
</pre></div>
</div>
<p>This means that your chosen platform and compiler combination doesn&#8217;t
currently support out-of-source builds. BATS looks for a build script
called:</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>$BASE/cism-piscees/builds/PLATFORM-COMPILER/PLATFORM-COMPILER-cmake.bash
</pre></div>
</div>
<p>which handles the out-of-source building. You will need to build CISM
manually, and then rerun BATS:</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>cd $BASE/cism-piscees/builds/PLATFORM-COMPILER/
source PLATFORM-COMPILER-cmake
make -j 8

cd $BASE/cism-piscees/tests/regression/
source setup_titan.bash
./build_and_test.py -p titan -c gnu --skip-build \
    -b $BASE/cism-piscees/builds/PLATFORM-COMPILER/ \
    -o $BASE/reg_test
</pre></div>
</div>
<p>Once BATS successfully runs, it will generate a <code class="docutils literal"><span class="pre">$BASE/reg_test</span></code>
directory, which will contain a <code class="docutils literal"><span class="pre">bash</span></code> script to submit all the test
runs. Submit the runs.</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>cd $BASE/reg_test/titan-gnu/
./submit_all_jobs.bash | tee submit_all_jobs.log
</pre></div>
</div>
<p>After all of your jobs have finished (job numbers will be found in
<code class="docutils literal"><span class="pre">submit_all_jobs.log</span></code>), you will have a full set of benchmark and test
data for LIVVkit.</p>
<p>To see if you still have active running jobs, you can use the command</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span><span class="n">showq</span> <span class="o">-</span><span class="n">u</span> <span class="n">USER</span>
</pre></div>
</div>
<p>which will show your current jobs, where <code class="docutils literal"><span class="pre">USER</span></code> is your user name on
titan (or hopper at NERSC). For more information on using a job
submission queue, see the users guide for your platform (<a class="reference external" href="https://www.olcf.ornl.gov/support/system-user-guides/titan-user-guide/">titans users
guide</a>
and <a class="reference external" href="https://www.nersc.gov/users/computational-systems/hopper/">hoppers users
guide</a>).</p>
<p>Note: If these steps are performed on a regular mac or linux personal
computer, <code class="docutils literal"><span class="pre">./build_and_test.py</span></code> will immediately run the jobs instead
of generating a job submission script.</p>
</div>
<div class="section" id="use-livvkit-to-analyze-the-data">
<h3>3. Use LIVVkit to analyze the data<a class="headerlink" href="#use-livvkit-to-analyze-the-data" title="Permalink to this headline">¶</a></h3>
<p>Now that the benchmark and test data has been generated, you can run
LIVVkit:</p>
<ul class="simple">
<li>If benchmark data exists on your platform:</li>
</ul>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>cd $BASE/LIVV
source setup_titan.bash
./livv.py -t $BASE/reg_test/titan-gnu --load configurations/titan
</pre></div>
</div>
<ul class="simple">
<li>If you downloaded the benchmark data:</li>
</ul>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span>cd $BASE/LIVV
source setup_titan.bash
./livv.py -t $BASE/reg_test/titan-gnu -b $BASE/reg_bench.PLATFORM.CISM-VERSION/
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">setup_titan.bash</span></code> script represents the last known &#8220;good&#8221;
combination of modules that works with LIVVkit. You may need to adjust
as these type of platforms change frequently. (There is also a
<code class="docutils literal"><span class="pre">setup_hopper.bash</span></code>). This line can be omitted in the case of linux or
mac platforms.</p>
<p>Once LIVVkit completes, you can look at the analysis in your preferred
internet browser.</p>
<div class="code sh highlight-default"><div class="highlight"><pre><span></span><span class="n">firefox</span> <span class="n">www</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Users workflow</a><ul>
<li><a class="reference internal" href="#getting-the-needed-benchmark-dataset">1. Getting the needed benchmark dataset</a><ul>
<li><a class="reference internal" href="#build-the-latest-version-of-cism-and-generate-the-test-dataset">2. Build the latest version of CISM and generate the test dataset</a></li>
<li><a class="reference internal" href="#use-livvkit-to-analyze-the-data">3. Use LIVVkit to analyze the data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Workflow-user.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Katherine Evans, Joseph Kennedy, Andrew Bennett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/Workflow-user.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>